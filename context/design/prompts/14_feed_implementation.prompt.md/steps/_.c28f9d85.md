---
timestamp: 'Sun Oct 19 2025 21:30:41 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251019_213041.933d74ec.md]]'
content_id: c28f9d858f6513725e9ce46b858f5af82ed4fbe397b9f054b9ebc3dc99c3a233
---

# Feed Concept Implementation Request

I need you to implement Concept E — Feed from the SwapIt marketplace system specification. This concept provides a browsable, filterable view of available listings and synchronizes with updates across listing states.

## Concept Specification

### Concept E — Feed

**Purpose:** Provide a browsable, filterable view of available listings and synchronize with updates across listing states.

**Types:**

* FeedView
* ListingId
* Tag

**State:**

```
feedIndex: List<ListingId>
tagIndex: Map<Tag -> List<ListingId>>
priceIndex: Map<PriceRange -> List<ListingId>>
```

**Actions:**

* `get_latest(n: Int) -> FeedView`
* `filter_by_tag(tag: Tag) -> FeedView`
* `filter_by_price(min: CurrencyAmount, max: CurrencyAmount) -> FeedView`
* `refresh_feed()`

**Notifications:**

* FeedUpdated

**Notes:**

* Only active listings are indexed
* Automatically updates when listings are created, withdrawn, or sold
* Feed reads data by ID — no shared access to ItemListing internals

## Implementation Requirements

### 1. **Default Sorting Behavior**

* **Primary Sort**: Listings are sorted by **recent first** (reverse chronological order by creation date)
* **Secondary Filters**: Tags and price filters can be applied, but the results are still sorted in reverse chronological order
* **Example**: If filtering by tag "electronics", the electronics listings should be returned with the most recent first, then older ones

### 2. **Technical Requirements**

* Use **Deno** with **TypeScript**
* Use **MongoDB** with the `npm:mongodb` driver
* Follow the same patterns as the other concepts (UserAccount, ItemListing, Bidding, MessagingThread)
* Include comprehensive error handling with custom error classes
* Implement proper event emission for `FeedUpdated` notifications
* Use the shared database utilities from `../../utils/database.ts`

### 3. **File Structure**

Create the following files:

```
src/concepts/Feed/
├── FeedConcept.ts              # Main implementation
├── FeedConcept.test.ts         # Comprehensive test suite
├── FeedErrors.ts              # Custom error classes
├── mock-services.ts           # Mock services for testing
├── fake-data.ts              # Fake data generators
└── types.ts                  # Type definitions
```

### 4. **Integration Points**

* The Feed concept should listen for events from ItemListing:
  * `ListingCreated` - Add new listing to indexes
  * `ListingUpdated` - Update indexes if needed
  * `ListingWithdrawn` - Remove from indexes
  * `ListingSold` - Remove from indexes
* Use an event bus system similar to other concepts
* The Feed should query ItemListing by ID to get listing details (no direct access to ItemListing internals)

### 5. **FeedView Structure**

Define a `FeedView` type that includes:

* Array of listing summaries (not full listing objects)
* Pagination information (total count, current page, etc.)
* Applied filters (if any)
* Sorting information

### 6. **Database Design**

* Use MongoDB collections for the indexes
* Implement efficient querying with proper indexes
* Handle pagination for large result sets
* Ensure atomic updates when refreshing the feed

### 7. **Testing Requirements**

* Follow the LikertSurvey test format used in other concepts
* Test categories: Correctness, Robustness, Performance, Usability, Maintainability, Testability
* Include tests for:
  * Basic feed retrieval with recent-first sorting
  * Tag filtering with chronological ordering
  * Price range filtering with chronological ordering
  * Combined filters (tag + price) with chronological ordering
  * Event handling and feed updates
  * Pagination functionality
  * Error handling for invalid inputs
  * Performance with large datasets

### 8. **Mock Services**

Create mock services for:

* Event bus for listening to ItemListing events
* ItemListing service for querying listing details by ID
* Database utilities for testing

### 9. **Fake Data**

Generate comprehensive fake data including:

* Various listing types with different tags
* Listings with different price ranges
* Listings created at different times (for chronological testing)
* Edge cases (very old listings, very new listings, etc.)

## Expected Behavior

1. **Default Feed**: `get_latest(10)` returns the 10 most recently created active listings
2. **Tag Filter**: `filter_by_tag("electronics")` returns all electronics listings, most recent first
3. **Price Filter**: `filter_by_price(50, 200)` returns listings in that price range, most recent first
4. **Combined Filters**: Should work together while maintaining chronological order
5. **Event Updates**: Feed automatically updates when ItemListing events occur
6. **Pagination**: Support for large result sets with proper pagination

Please implement this Feed concept with all the specified requirements, comprehensive tests, and fake data. The implementation should be production-ready and follow the same patterns as the other concepts in the system.
