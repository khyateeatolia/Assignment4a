---
timestamp: 'Sun Oct 19 2025 14:39:39 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251019_143939.c2ba97f2.md]]'
content_id: 2aba9e331777ea408691213f8da57dcfc6e9cd4e8ec2accdc5940874a31729a6
---

# Updated UserAccount Concept Specification

## Role

You are a senior software architect. I need you to rewrite the UserAccount concept specification to use SSO (Single Sign-On) authentication instead of email verification, and include full profile management capabilities.

## Current Specification

Based on the existing specification: [@](../../SwapIt_spec.md)

## New Requirements

### Authentication Approach

* **SSO Integration**: Use school's existing authentication system (e.g., OAuth, SAML, LDAP)
* **No Email Verification**: Remove manual email verification process
* **Third-party Authentication**: Delegate authentication to school's identity provider
* **Automatic User Creation**: Create user account on first successful SSO login

### New Actions Required

1. **`register_or_login(ssoToken: SSOToken) -> UserId`**
   * Handles both registration and login via SSO
   * Creates account on first login, returns existing user on subsequent logins
   * Validates SSO token with school's identity provider

2. **`logout(userId: UserId) -> void`**
   * Logs out the user from the platform
   * Invalidates any session tokens
   * Emits UserLoggedOut event

3. **`change_avatar(userId: UserId, newAvatar: Url) -> void`**
   * Updates user's avatar URL
   * Requires authenticated user

4. **`change_bio(userId: UserId, bio: String) -> void`**
   * Updates user's biography
   * Requires authenticated user

5. **`change_password(userId: UserId, currentPassword: String, newPassword: String) -> void`**
   * Changes user's password
   * Requires current password verification
   * Only applicable if using local password storage (not pure SSO)

6. **`delete_account(userId: UserId) -> void`**
   * Deletes user account and all associated data
   * Emits UserDeleted event

7. **`view_profile(userId: UserId) -> ProfileView`**
   * Retrieves user's public profile
   * Returns combined user and profile data

### State Changes

* **Remove**: `pending_verifications` collection (no longer needed)
* **Add**: `sessions` collection for session management
* **Update**: User model to include SSO provider information
* **Keep**: `users` and `profiles` collections with enhanced fields

### New Types

* `SSOToken` - Token from school's authentication system
* `SessionId` - Platform session identifier
* `SSOProvider` - School's identity provider (e.g., "university.edu", "google.edu")
* `PasswordHash` - Hashed password (if storing locally)

### Enhanced User Model

```typescript
interface User {
    _id: ObjectId;
    email: EmailAddress;           // From SSO provider
    username: Username;             // Immutable, set on first login
    avatarUrl?: Url;                // Editable
    bio?: String;                  // Editable
    ssoProvider: SSOProvider;      // Which school system
    ssoId: String;                 // User ID in school system
    createdAt: Timestamp;
    lastLoginAt: Timestamp;
    isActive: Boolean;             // For account deactivation
}
```

### Enhanced Profile Model

```typescript
interface Profile {
    _id: ObjectId;                 // Corresponds to UserId
    bio?: String;                  // Editable
    listings: List<ListingId>;
    bids: List<BidId>;
    threads: List<ThreadId>;
}
```

### New Notifications

* `UserRegistered(UserId)` - Emitted on first SSO login
* `UserLoggedIn(UserId)` - Emitted on successful login
* `UserLoggedOut(UserId)` - Emitted on logout
* `UserDeleted(UserId)` - Emitted on account deletion
* `ProfileUpdated(UserId)` - Emitted on avatar/bio changes

### SSO Integration Options

1. **OAuth 2.0**: Most common, supports Google, Microsoft, etc.
2. **SAML**: Enterprise standard, used by many universities
3. **LDAP**: Direct integration with university directory
4. **Custom API**: School-specific authentication endpoint

### Security Considerations

* **Token Validation**: Verify SSO tokens with school's identity provider
* **Session Management**: Implement secure session handling
* **Rate Limiting**: Prevent brute force attacks
* **Data Privacy**: Comply with school's data policies
* **Audit Logging**: Track authentication events

## Output Format

* **Updated Concept Specification**: Complete rewrite of the UserAccount concept
* **SSO Integration Strategy**: Recommended approach for school authentication
* **Implementation Notes**: Technical considerations for SSO integration
* **Migration Strategy**: How to transition from email verification to SSO

## Constraints

* Must maintain compatibility with existing ItemListing, Bidding, and MessagingThread concepts
* Must preserve the profile synchronization mechanism
* Must support multiple SSO providers (different schools)
* Must handle both new user registration and existing user login
* Must maintain username immutability
* Must support account deactivation/reactivation

## Expected Output

A complete, updated UserAccount concept specification that uses SSO authentication and provides full profile management capabilities.
